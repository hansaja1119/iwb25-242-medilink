# Lab Report Service Data Types

# Test Type entity
public type TestType record {|
    # Unique identifier for the test type
    string id;
    # Name of the test type
    string name;
    # Description of the test type
    string description;
    # Test category
    string category;
    # Parser configuration for extracting data
    json parserConfig?;
    # Reference ranges for the test
    json referenceRanges?;
    # Units of measurement
    string units?;
    # Creation timestamp
    string createdAt;
    # Last update timestamp
    string updatedAt;
|};

# Test Type Create payload
public type TestTypeCreate record {
    # Name of the test type
    string name;
    # Description of the test type
    string description;
    # Test category
    string category;
    # Parser configuration for extracting data
    json? parserConfig;
    # Reference ranges for the test
    json? referenceRanges;
    # Units of measurement
    string? units;
};

# Test Type Update payload
public type TestTypeUpdate record {
    # Name of the test type
    string? name;
    # Description of the test type
    string? description;
    # Test category
    string? category;
    # Parser configuration for extracting data
    json? parserConfig;
    # Reference ranges for the test
    json? referenceRanges;
    # Units of measurement
    string? units;
};

# Lab Sample entity
public type LabSample record {|
    # Unique identifier for the sample
    string id;
    # Patient ID associated with the sample
    string patientId;
    # Test type ID
    string testTypeId;
    # Sample collection date
    string collectionDate;
    # Sample status (collected, processing, completed)
    string status;
    # Priority level (normal, urgent, stat)
    string? priority;
    # Collection notes
    string? notes;
    # Who collected the sample
    string? collectedBy;
    # Who processed the sample
    string? processedBy;
    # When processing started
    string? processedAt;
    # When sample was completed
    string? completedAt;
    # Creation timestamp
    string createdAt;
    # Last update timestamp
    string updatedAt;
|};

# Lab Sample Create payload
public type LabSampleCreate record {|
    # Patient ID associated with the sample
    string patientId;
    # Test type ID
    string testTypeId;
    # Sample collection date
    string collectionDate;
    # Priority level (normal, urgent, stat)
    string? priority;
    # Collection notes
    string? notes;
    # Who collected the sample
    string? collectedBy;
|};

# Lab Result entity
public type LabResult record {|
    # Unique identifier for the result
    string id;
    # Sample ID associated with the result
    string sampleId;
    # Test type ID
    string testTypeId;
    # Test results (can be complex JSON)
    json results;
    # Normal ranges for comparison
    json? normalRanges;
    # Result status (pending_review, reviewed, flagged)
    string status;
    # Who reviewed the results
    string? reviewedBy;
    # When results were reviewed
    string? reviewedAt;
    # When results were completed
    string? completedAt;
    # Comments or notes about the result
    string? notes;
    # Result date when test was performed
    string resultDate;
    # Actual result value
    string resultValue;
    # Creation timestamp
    string createdAt;
    # Last update timestamp
    string updatedAt;
|};

# Lab Result Create payload
public type LabResultCreate record {|
    # Sample ID associated with the result
    string sampleId;
    # Test type ID
    string testTypeId;
    # Test results (can be complex JSON)
    json results;
    # Normal ranges for comparison
    json? normalRanges;
    # Who reviewed the results
    string? reviewedBy;
    # Comments or notes about the result
    string? notes;
    # Result date when test was performed
    string resultDate;
    # Actual result value
    string resultValue;
|};

# Lab Result Update payload
public type LabResultUpdate record {
    json? results;
    json? normalRanges;
    string? status;
    string? reviewedBy;
    string? notes;
};

# Lab Report entity
public type LabReport record {
    string id;
    string sampleId;
    string? templateId;
    json content;
    string status; // "draft", "finalized"
    string? generatedBy;
    string? generatedAt;
    string? finalizedBy;
    string? finalizedAt;
    string createdAt;
    string updatedAt;
};

# Lab Report DTO
public type LabReportDto record {|
    # Report ID
    string id;
    # Patient information
    PatientInfo patient;
    # Sample information
    LabSample sample;
    # Test results
    LabResult[] results;
    # Report status
    string status;
    # Report generation date
    string reportDate;
    # Doctor information
    DoctorInfo doctor?;
    # Additional metadata
    json metadata?;
|};

# Patient information
public type PatientInfo record {|
    # Patient ID
    string id;
    # Patient name
    string name;
    # Date of birth
    string dateOfBirth;
    # Gender
    string gender;
    # Contact information
    ContactInfo contact?;
|};

# Contact information
public type ContactInfo record {|
    # Phone number
    string phone?;
    # Email address
    string email?;
    # Address
    AddressInfo address?;
|};

# Address information
public type AddressInfo record {|
    # Street address
    string street?;
    # City
    string city?;
    # State or province
    string state?;
    # Postal code
    string postalCode?;
    # Country
    string country?;
|};

# Doctor information
public type DoctorInfo record {|
    # Doctor ID
    string id;
    # Doctor name
    string name;
    # Specialization
    string specialization?;
    # License number
    string licenseNumber?;
    # Contact information
    ContactInfo contact?;
|};

# Workflow status
public type WorkflowStatus record {
    # Workflow ID
    string id;
    # Current status
    string status;
    # Sample ID being processed
    string sampleId;
    # Processing steps
    ProcessingStep[] steps;
    # Start time
    string startTime;
    # End time (if completed)
    string? endTime;
    # Error information (if any)
    string? errorMessage;
};

# Processing step
public type ProcessingStep record {
    # Step name
    string name;
    # Step status
    string status;
    # Start time
    string startTime;
    # End time (if completed)
    string? endTime;
    # Step result or output
    json? result;
    # Error message (if failed)
    string? errorMessage;
};

# Template information
public type Template record {|
    # Template ID
    string id;
    # Template name
    string name;
    # Template description
    string description;
    # Template content/structure
    json content;
    # Test types this template supports
    string[] supportedTestTypes;
    # Template version
    string version;
    # Creation timestamp
    string createdAt;
    # Last update timestamp
    string updatedAt;
|};

# Report Template Types
public type ReportTemplate record {
    string id;
    string name;
    string description;
    string testTypeId;
    TemplateSection[] sections;
    boolean isActive;
    string? createdBy;
    string createdAt;
    string updatedAt;
};

public type TemplateSection record {
    string id;
    string name;
    string sectionType; // "header", "patient_info", "test_results", "interpretation", "footer"
    int orderIndex;
    json content;
};

public type ReportTemplateCreate record {
    string name;
    string description;
    string testTypeId;
    TemplateSection[] sections;
    boolean? isActive;
    string? createdBy;
};

public type ReportTemplateUpdate record {
    string? name;
    string? description;
    TemplateSection[]? sections;
    boolean? isActive;
};

# API Response wrapper
public type ApiResponse record {|
    # Response message
    string message;
    # Response data
    anydata data?;
    # Error information
    string 'error?;
    # Timestamp
    string timestamp;
    # Pagination info (for list endpoints)
    PaginationInfo pagination?;
|};

# Pagination information
public type PaginationInfo record {|
    # Current page number
    int page;
    # Number of items per page
    int pageSize;
    # Total number of items
    int totalItems;
    # Total number of pages
    int totalPages;
    # Has next page
    boolean hasNext;
    # Has previous page
    boolean hasPrevious;
|};

# Event data for Kafka
public type LabSampleCreatedEvent record {|
    # Event ID
    string eventId;
    # Sample ID
    string sampleId;
    # Patient ID
    string patientId;
    # Event timestamp
    string timestamp;
    # Sample data
    LabSample sampleData;
    # Event metadata
    json metadata?;
|};

# File upload information
public type FileUploadInfo record {|
    # File ID
    string id;
    # Original filename
    string filename;
    # File size in bytes
    int size;
    # MIME type
    string mimeType;
    # Upload timestamp
    string uploadedAt;
    # File path or URL
    string path;
    # Associated sample ID
    string sampleId?;
    # Processing status
    string processingStatus;
|};
